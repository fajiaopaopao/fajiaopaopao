title: 【读书笔记】The Grammar of Graphics - 1. Introduction
date: 2021-01-03
categories:
- 可视化
- 图形语法学
tags:
- 图形语法学
language: zh-CN
toc: true
---

《The Grammar of Graphics》是作者[Leland Wilkinson](https://en.wikipedia.org/wiki/Leland_Wilkinson)在开发[GPL](http://www.unige.ch/ses/sococ/cl/spss/graph/gpl.html)过程中，所沉淀的一本关于图形语法学的著作。号称是很多流行图表库（例如：G2、Vega、ggplot2）的理论基础，希望自己能坚持读完，也能在其中有所收获。
<!-- more -->

“语法”一词的英文“Grammar”来自古希腊语γραμματικὴ τέχνη（grammatikē technē），意思是“字母的艺术”。语法给出语言的规则，是一套“体系内元素的组合规则”，用于生成语言中的合法陈述。

在图表分类理论中，我们知道有柱状图、折线图、饼图、散点图等这些图表，但是现实生活中是不是只有这些图表呢？当然不是，随着计算机的普及和图形学的发展，统计需求得到进一步的丰富和发展。新的可视化图表层出不穷的出现，如：雷达图、桑吉图、K线图等，如果以传统的分类方式去枚举实现各种图表，将会是个巨大且难以维护和复用的工作。

那么问题来了，如何以比较小的代价尽可能多的穷举图形呢？

通过分析现象看到本质，其实这个问题总的来说就是：**如何可视化来表达图表的问题**，作者通过对各种图表进行研究和分析后，一套语法描述图形的理论诞生了，编写基于图形语法的软件包有了理论依据和设计实践指导。

## 1.1 图形 VS 图表
我们经常称统计图为“某某图”或者“Chart”，例如饼图(pie chart)、条形图(bar chart)、折线图(line chart)等。在图形语法学中，我们应该避免探讨图表分类，图形和图表的区别在于图形是比图表更基本的视觉元素。一旦我们理解，饼图其实是堆叠条形图在极坐标的呈现，我们就能在极坐标下构建更多鲜为人知的图形。

如果我们是在埋头开发某个类型图表，而不是制图程序，我们将面临两个问题：
1. 我们不可避免无法满足人们所有的图表可视化需求，因为人们的需求是在不断变化的，我们无法马上去开发和提供大家想要的图表
2. 我们可能无法复用不同图表的代码和设计

我们需要思考抽象构成构成图表的基础元素，我们需要考虑图形理论，而不是在纠结具体的某个图表。很多BI产品和图表库只提供一些固定的图表类型选择，这样有利于用户使用和理解，同时给用户提供了便利，但是对我们深入理解图形没有参考价值。

## 1.2 面向对象设计
本书很多见解都受到了面向对象设计的启发，在大学课程中我们就学习过面向对象编程了，这里不做过多的阐述了，知乎有个话题：[如何通俗易懂地举例说明「面向对象」和「面向过程」有什么区别？](https://www.zhihu.com/question/27468564) 解释的挺通俗易懂。

## 1.3 一个面向对象的图形系统
在数学中，**图(graph)** 是代表了满足公式的点的集合，它是不可见的。在物理中，**图形(graphic)** 是图(graph)的物理呈现，这就使得图形需要大小、颜​​色等美学属性来呈现的。

在一个面向对象系统中，图形通常是一个对象，但它本身具有位置、颜色、坐标等对象的属性，这使得该图形系统具有通用性，但这只是基于一些简单的对象和规则，下面将继续揭示这种系统的丰富性。
### 图形创作的三个阶段：
• 规格（Specification）
• 装配（Assembly）
• 展示（Display）

### Specification
这里 **Specification** 可以理解为描述图形属性的规格描述，用户可能不需要知道这些规则，但是制图系统需要理解和遵循这些规则、语法。

统计图形的规格描述可以用以下六个语句表示：
1. DATA: 数据可视化基于的数据源
2. TRANS: 对数据的一些转化操作，如聚合、排序、筛选等
3. SCALE: 缩放操作，如log
4. COORD: 坐标系统，如极坐标系、直角坐标系
5. ELEMENT: 图形的视觉元素与属性，如颜色、大小、形状
6. GUIDE: 提示信息，如刻度、图例

### Assembly
一个场景画面和它的规格描述还是有很大不同的。为了依据规格描述绘制出画面，我们必须要处理它的几何、布局、美学属性等等来使它的场景被精准地渲染出来。
一个统计图的制图系统和体系必须要能够从一份规格说明装配成一幅真正的图表。
### Display
为了让我们感知图形，需要将图形渲染在某一种介质上，例如：显示器、报纸，视频等。除了基本的绘图功能外，我们还可能需要实现刷新、下钻、上卷、缩放等复杂的交互

## 1.4 举个例子
{% img "box px-0 py-0 ml-auto mr-auto" /assets/2021-01-04/birth-rate.png 500 '"图1：不同国家出生率/死亡率对比图" "图1：不同国家出生率/死亡率对比图"' %}

下面来实际使用图形创作的三个阶段：

**Specification**

```
ELEMENT: point(position(birth*death), size(0), label(country))
ELEMENT: contour(position(
            smooth.density.kernel.epanechnikov.joint(birth*death)),
            color.hue()
)
GUIDE: form.line(position((0,0),(30,30)), label("Zero Population Growth"))
GUIDE: axis(dim(1), label("Birth Rate"))
GUIDE: axis(dim(2), label("Death Rate"))
```

上面的规格描述仅使用到了ELEMENT和GUIDE组件，那么DATA、TRANS、SCALE、COORD都为默认没有操作，坐标系为笛卡尔坐标系。

- 第一个ELEMENT：表示为一个点，这个点的位置由birth*death决定，这个点不实际显示，因为的size大小为0，label内容为国家名称
- 第二个ELEMENT：表示等高线图，用来代表不同区域中国家的密度。彼此靠近的国家越多，密度等值线就越高。
- 第一个GUIDE：表示零人口增长线，辅助线左边的国家人口趋向下降，辅助线右边的国家人口趋向增长
- 接下来的两个GUIDE分别用来表示出生率、死亡率的轴、以及刻度、轴名称
## 参考链接

- [Antv: 数据可视化图形语法简史](https://www.yuque.com/antv/blog/hq2dmt)
- [图之典](http://tuzhidian.com/)
- [正经可视化: 第一章 图形语法学简介](https://www.yuque.com/neowang/zjvis/gg_intro)
- [[The Grammar of Graphics 笔记] 1.介绍](https://zhuanlan.zhihu.com/p/54469454)